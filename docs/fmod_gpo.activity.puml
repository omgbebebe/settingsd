@startuml

start

:boot;
note right
at boot time the <b>gpoA service unit</b>
will update and apply GPOs for machine
end note

:update machine's GPOs;
note right
after fetching a new policies container
it should be merged with default one
that was supplied by gpoA package
end note

:apply machine's GPOs;

:wait for user login;

fork
:login on TTY;
fork again
:sshd;
fork again
:display manager;
end fork

:PAM;
partition "PAM auth" {
:default modules;
}
partition "PAM session" {
:default modules;
:pam_loginuid.so;
note right
to route progress messages via DBUS
we need to obtain an unique routing key.
it may be generated by <b>pam_loginuid.so</b>
module
end note

:pam_gpo.so;
note right
this module will trigger the <b>settingsd</b>
DBUS service with <b>SESSIONID</b> that will be
used as a signal name which will be fired with
status messages from <b>gpoA</b> application
end note
}

:to be continued...;
note right
In this approach the routing key is SESSION_ID
that will be generated by pam_loginuid.so, but
how display manager can get this key to subscribe
to the signals?
end note
@enduml
